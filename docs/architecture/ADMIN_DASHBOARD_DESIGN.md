# 管理画面ダッシュボード設計書

**バージョン**: 2.1.0
**最終更新日**: 2026-01-31
**ステータス**: Active

## 関連ドキュメント

- [GLOSSARY.md](./GLOSSARY.md) - 用語定義
- [ANALYTICS_DESIGN.md](./ANALYTICS_DESIGN.md) - 分析・レポート機能
- [KARTE_DESIGN.md](./KARTE_DESIGN.md) - カルテ機能
- [API_DESIGN.md](./API_DESIGN.md) - API設計
- [ERROR_HANDLING_AND_LOGGING.md](./ERROR_HANDLING_AND_LOGGING.md) - エラーハンドリング
- [MONITORING_AND_ALERTING.md](./MONITORING_AND_ALERTING.md) - 監視とアラート

---

## 1. 概要

### 1.1 設計コンセプト

モダンでシンプルな管理画面を実現する。

**参考UI:**
- Square POS のクリーンさ
- SalonX の美容室特化機能
- Notion のシンプルなナビゲーション

**デザイン原則:**
- **シンプル**: 必要な情報だけを表示
- **直感的**: 学習コストゼロ
- **モダン**: 洗練されたビジュアル
- **レスポンシブ**: タブレット・PC両対応

### 1.2 技術スタック

| 項目 | 技術 |
|------|------|
| フレームワーク | Next.js 14 (App Router) |
| UIライブラリ | shadcn/ui + Radix UI |
| スタイリング | Tailwind CSS |
| 状態管理 | React Query + Zustand |
| グラフ | Recharts |
| フォーム | React Hook Form + Zod |

### 1.3 データ基盤

- API経由で Cloud SQL（PostgreSQL）にアクセス
- テナント/店舗切替は `tenant_id` と `store_id` で制御

---

## 2. 画面構成

### 2.1 サイドバーナビゲーション

```
┌────────────────────────────────────────────────────────────────────────────────┐
│                                                                                │
│  ┌──────────────┐  ┌───────────────────────────────────────────────────────┐  │
│  │              │  │                                                       │  │
│  │   SALON      │  │                      メインコンテンツ                 │  │
│  │   NAME       │  │                                                       │  │
│  │              │  │                                                       │  │
│  ├──────────────┤  │                                                       │  │
│  │              │  │                                                       │  │
│  │  🏠 ホーム    │  │                                                       │  │
│  │              │  │                                                       │  │
│  │  🛒 レジ      │  │                                                       │  │
│  │              │  │                                                       │  │
│  │  📅 カレンダー│  │                                                       │  │
│  │              │  │                                                       │  │
│  │  📋 予約     │  │                                                       │  │
│  │              │  │                                                       │  │
│  │  📝 カルテ   │  │                                                       │  │
│  │              │  │                                                       │  │
│  │  📊 レポート │  │                                                       │  │
│  │              │  │                                                       │  │
│  │  📦 在庫管理 │  │                                                       │  │
│  │              │  │                                                       │  │
│  │  👥 顧客     │  │                                                       │  │
│  │              │  │                                                       │  │
│  │  👤 スタッフ │  │                                                       │  │
│  │              │  │                                                       │  │
│  │  🏪 店舗設定 │  │                                                       │  │
│  │              │  │                                                       │  │
│  ├──────────────┤  │                                                       │  │
│  │              │  │                                                       │  │
│  │  👤 田中太郎 │  │                                                       │  │
│  │  manager     │  │                                                       │  │
│  └──────────────┘  └───────────────────────────────────────────────────────┘  │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 メニュー構成

| メニュー | 機能 | 対象ユーザー |
|---------|------|------------|
| **ホーム** | ダッシュボード、今日の概要 | 全員 |
| **レジ** | 会計処理、決済 | 全員 |
| **カレンダー** | 予約カレンダー（週間・日別） | 全員 |
| **予約** | 予約一覧、新規作成 | 全員 |
| **カルテ** | 顧客施術履歴 | 全員 |
| **レポート** | 売上・分析 | manager, owner |
| **在庫管理** | 商品・材料管理 | manager, owner |
| **顧客** | 顧客一覧・詳細 | 全員 |
| **スタッフ** | スタッフ管理 | manager, owner |
| **店舗設定** | メニュー・営業時間等 | manager, owner |

### 2.3 HQダッシュボード / 店舗セレクター

- 画面右上に **店舗セレクター** を配置
- `All Stores` を選択すると HQ 向けの横断KPI/売上ランキングを表示
- ストア選択時は `store_id` を API に渡し、店舗別の数値に切替

---

## 3. 画面詳細設計

### 3.1 ホーム（ダッシュボード）

SalonX画像を参考にした、シンプルで情報が一目で分かるダッシュボード。

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  ようこそ！                                                                  │
│  今日のサロンの状況                                                          │
│                                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│  │ 本日の売上    │  │ 本日の予約    │  │ 新規顧客     │  │ 平均客単価    │    │
│  │              │  │              │  │              │  │              │    │
│  │   ¥58,300    │  │     8件      │  │     3名      │  │   ¥7,288     │    │
│  │   +12% ↑     │  │   -2件 ↓    │  │   +1名 ↑    │  │   +5% ↑     │    │
│  │   前日比      │  │   前日比      │  │   前日比      │  │   前日比      │    │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘    │
│                                                                             │
│  ┌──────────────────────────────────┐  ┌──────────────────────────────────┐ │
│  │ 本日の予約                       │  │ スタッフ稼働                      │ │
│  │                                  │  │                                  │ │
│  │  🔵 10:00 - 11:30                │  │  中村 健                          │ │
│  │     山田花子 / カット+カラー   完了 │  │  ████████████░░░░  75%           │ │
│  │                                  │  │                                  │ │
│  │  🔵 11:00 - 12:00                │  │  小林 玲奈                        │ │
│  │     佐藤一郎 / カット         完了 │  │  ██████████░░░░░░  60%           │ │
│  │                                  │  │                                  │ │
│  │  🟡 14:00 - 15:30                │  │  加藤 大輔                        │ │
│  │     鈴木美咲 / パーマ       予約済 │  │  ████░░░░░░░░░░░░  25%           │ │
│  │                                  │  │                                  │ │
│  │  🟢 15:00 - 16:00                │  │  佐藤 由美                        │ │
│  │     田中健太 / カット       来店中 │  │  ████████████████  100%          │ │
│  │                                  │  │                                  │ │
│  │           [詳細を見る]            │  │           [詳細を見る]            │ │
│  └──────────────────────────────────┘  └──────────────────────────────────┘ │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**KPIカード コンポーネント:**

```tsx
// components/dashboard/KPICard.tsx
interface KPICardProps {
  title: string;
  value: string | number;
  change?: number;         // 前日比（パーセント or 数値）
  changeType?: 'percent' | 'value';
  trend?: 'up' | 'down' | 'neutral';
  icon?: React.ReactNode;
}

export function KPICard({ title, value, change, changeType, trend, icon }: KPICardProps) {
  return (
    <Card className="p-6">
      <div className="flex items-center justify-between">
        <p className="text-sm text-muted-foreground">{title}</p>
        {icon && <span className="text-muted-foreground">{icon}</span>}
      </div>
      <div className="mt-2">
        <p className="text-3xl font-bold">{value}</p>
        {change !== undefined && (
          <div className={cn(
            "flex items-center mt-1 text-sm",
            trend === 'up' && "text-green-600",
            trend === 'down' && "text-red-600",
            trend === 'neutral' && "text-gray-500"
          )}>
            {trend === 'up' ? <ArrowUpIcon /> : trend === 'down' ? <ArrowDownIcon /> : null}
            <span>{changeType === 'percent' ? `${change}%` : change} 前日比</span>
          </div>
        )}
      </div>
    </Card>
  );
}
```

### 3.2 カレンダー画面

予約状況を視覚的に確認できるカレンダービュー。

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  カレンダー                                           [週] [日] [月]         │
│                                                                             │
│  ← 2025年1月27日 〜 2月2日 →                              [＋ 新規予約]      │
│                                                                             │
│  ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐   │
│  │  月 27   │  火 28   │  水 29   │  木 30   │  金 31   │  土 1    │  日 2    │   │
│  ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤   │
│  │ 9:00    │         │         │         │         │         │         │   │
│  │         │ ┌─────┐ │         │ ┌─────┐ │         │ ┌─────┐ │         │   │
│  │ 10:00   │ │山田  │ │         │ │佐藤  │ │         │ │高橋  │ │         │   │
│  │         │ │カット│ │         │ │カラー│ │         │ │パーマ│ │         │   │
│  │ 11:00   │ │田中  │ │ ┌─────┐ │ │小林  │ │         │ │鈴木  │ │         │   │
│  │         │ └─────┘ │ │鈴木  │ │ └─────┘ │ ┌─────┐ │ └─────┘ │         │   │
│  │ 12:00   │         │ │カット│ │         │ │渡辺  │ │         │         │   │
│  │         │         │ │佐藤  │ │         │ │縮毛  │ │         │         │   │
│  │ 13:00   │ 昼休み   │ └─────┘ │ 昼休み   │ │田中  │ │ ┌─────┐ │         │   │
│  │         │         │         │         │ └─────┘ │ │伊藤  │ │         │   │
│  │ 14:00   │ ┌─────┐ │         │ ┌─────┐ │         │ │カット│ │         │   │
│  │         │ │田中  │ │         │ │山本  │ │         │ │加藤  │ │         │   │
│  │ 15:00   │ │カラー│ │         │ │カット│ │         │ └─────┘ │         │   │
│  │         │ │田中  │ │         │ │中村  │ │         │         │         │   │
│  │ 16:00   │ └─────┘ │         │ └─────┘ │         │         │         │   │
│  └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘   │
│                                                                             │
│  スタッフ別フィルター: [全員 ▾]  [中村] [小林] [加藤] [佐藤] [鈴木]          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 顧客一覧画面

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  顧客                                                    [＋ 新規登録]       │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │ 🔍 顧客名・電話番号で検索                            [タグで絞込 ▾]   │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │ 顧客             │ タグ          │ 来店回数 │ 累計売上  │ 最終来店  │ │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │ 🖼 山田 花子     │ [VIP][カラー] │   12回   │ ¥156,000 │ 1/15    │→│   │
│  │   090-xxxx-xxxx │               │          │          │         │ │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │ 🖼 佐藤 一郎     │ [常連]        │    8回   │  ¥64,000 │ 1/20    │→│   │
│  │   080-xxxx-xxxx │               │          │          │         │ │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │ 🖼 鈴木 美咲     │ [新規]        │    1回   │   ¥8,000 │ 1/25    │→│   │
│  │   070-xxxx-xxxx │               │          │          │         │ │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │ 🖼 田中 健太     │ [学生]        │    5回   │  ¥25,000 │ 1/10    │→│   │
│  │   090-xxxx-xxxx │               │          │          │         │ │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ← 1 2 3 4 5 ... 10 →                                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 レポート画面

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  レポート                                    期間: [今月 ▾] [1/1 〜 1/31]    │
│                                                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │  売上推移                                                              │ │
│  │                                                                        │ │
│  │  ¥2M ┤                                                   ╭───         │ │
│  │      │                                              ╭────╯            │ │
│  │  ¥1M ┤                         ╭────────────────────╯                 │ │
│  │      │    ╭────────────────────╯                                      │ │
│  │   ¥0 ┼────╯────────────────────────────────────────────────           │ │
│  │       1/1      1/7      1/14      1/21      1/28                      │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌──────────────────────────────────┐  ┌──────────────────────────────────┐ │
│  │ メニュー別売上                    │  │ スタッフ別売上                    │ │
│  │                                  │  │                                  │ │
│  │  カット        ¥450,000  (40%)   │  │  中村 健      ¥320,000  (28%)   │ │
│  │  ████████████████                │  │  █████████████                   │ │
│  │                                  │  │                                  │ │
│  │  カラー        ¥350,000  (31%)   │  │  小林 玲奈    ¥280,000  (25%)   │ │
│  │  ████████████                    │  │  ███████████                     │ │
│  │                                  │  │                                  │ │
│  │  パーマ        ¥180,000  (16%)   │  │  加藤 大輔    ¥200,000  (18%)   │ │
│  │  ██████                          │  │  ████████                        │ │
│  │                                  │  │                                  │ │
│  │  縮毛矯正      ¥120,000  (11%)   │  │  佐藤 由美    ¥180,000  (16%)   │ │
│  │  ████                            │  │  ███████                         │ │
│  │                                  │  │                                  │ │
│  │  その他         ¥25,000   (2%)   │  │  鈴木 大樹    ¥145,000  (13%)   │ │
│  │  █                               │  │  █████                           │ │
│  │                                  │  │                                  │ │
│  └──────────────────────────────────┘  └──────────────────────────────────┘ │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.5 顧客セグメント分析（RFM分析）

**重要**: テナントごとにビジネスモデルが異なるため、RFMスコアの閾値をカスタマイズ可能にします。

#### 3.5.1 RFM設定画面

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  顧客分析設定                                              [デフォルトに戻す]  │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  RFMスコア閾値の設定                                                  │   │
│  │                                                                      │   │
│  │  Recency（最終来店からの日数）                                        │   │
│  │  ┌────────────────────────────────────────────────────────┐         │   │
│  │  │ スコア5: 0〜30日    [30 ▾]                             │         │   │
│  │  │ スコア4: 31〜60日   [60 ▾]                             │         │   │
│  │  │ スコア3: 61〜90日   [90 ▾]                             │         │   │
│  │  │ スコア2: 91〜180日  [180 ▾]                            │         │   │
│  │  │ スコア1: 181日以上                                      │         │   │
│  │  └────────────────────────────────────────────────────────┘         │   │
│  │                                                                      │   │
│  │  Frequency（来店回数 / 過去1年）                                      │   │
│  │  ┌────────────────────────────────────────────────────────┐         │   │
│  │  │ スコア5: 12回以上   [12 ▾]                             │         │   │
│  │  │ スコア4: 8〜11回    [8 ▾]                              │         │   │
│  │  │ スコア3: 4〜7回     [4 ▾]                              │         │   │
│  │  │ スコア2: 2〜3回     [2 ▾]                              │         │   │
│  │  │ スコア1: 1回                                            │         │   │
│  │  └────────────────────────────────────────────────────────┘         │   │
│  │                                                                      │   │
│  │  Monetary（累計支払額 / 過去1年）                                     │   │
│  │  ┌────────────────────────────────────────────────────────┐         │   │
│  │  │ スコア5: ¥100,000以上  [100000 ▾]                      │         │   │
│  │  │ スコア4: ¥50,000〜     [50000 ▾]                       │         │   │
│  │  │ スコア3: ¥20,000〜     [20000 ▾]                       │         │   │
│  │  │ スコア2: ¥10,000〜     [10000 ▾]                       │         │   │
│  │  │ スコア1: ¥10,000未満                                    │         │   │
│  │  └────────────────────────────────────────────────────────┘         │   │
│  │                                                                      │   │
│  │  💡 ヒント: あなたのサロンの平均客単価と来店頻度に基づいて         │   │
│  │           閾値を調整すると、より精度の高いセグメント分けが可能です。 │   │
│  │                                                                      │   │
│  │                                              [キャンセル] [保存]     │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### 3.5.2 顧客セグメント一覧

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  顧客セグメント                                          [⚙️ 設定を変更]      │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  セグメント          │ 顧客数  │ 平均LTV    │ アクション             │ │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │  🌟 Champions       │   45名  │ ¥156,000  │ [VIP特典送信]         │→│   │
│  │  (最優良顧客)        │         │           │ [サンクスメッセージ]   │ │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │  💎 Loyal Customers │   78名  │  ¥98,000  │ [紹介キャンペーン]     │→│   │
│  │  (ロイヤル顧客)      │         │           │                       │ │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │  ⚠️ At Risk         │   32名  │  ¥45,000  │ [復帰クーポン送信]     │→│   │
│  │  (離脱危機)         │         │           │ [カムバックキャンペーン]│ │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │  😴 Hibernating    │   56名  │  ¥32,000  │ [再訪キャンペーン]     │→│   │
│  │  (休眠)            │         │           │                       │ │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │  🆕 New Customers   │   23名  │  ¥12,000  │ [ウェルカムクーポン]   │→│   │
│  │  (新規顧客)         │         │           │ [次回予約リマインド]   │ │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  💡 推奨アクション:                                                          │
│  • At Risk 顧客 32名に復帰クーポンを送信すると、推定 ¥480,000 の売上回復    │
│  • Hibernating 顧客のうち高単価だった15名を優先的にフォローアップ           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### 3.5.3 RFM設定データモデル

```typescript
// /tenants/{tenantId}/settings/rfmThresholds
interface RFMThresholds {
  tenantId: string;

  recency: {
    score5: number;  // 0-30日
    score4: number;  // 31-60日
    score3: number;  // 61-90日
    score2: number;  // 91-180日
    // score1: 181日以上（自動計算）
  };

  frequency: {
    score5: number;  // 12回以上
    score4: number;  // 8-11回
    score3: number;  // 4-7回
    score2: number;  // 2-3回
    // score1: 1回（自動計算）
  };

  monetary: {
    score5: number;  // ¥100,000以上
    score4: number;  // ¥50,000-
    score3: number;  // ¥20,000-
    score2: number;  // ¥10,000-
    // score1: ¥10,000未満（自動計算）
  };

  // メタデータ
  updatedAt: Timestamp;
  updatedBy: string;  // 設定変更者のUID
}

// デフォルト値
export const DEFAULT_RFM_THRESHOLDS: Omit<RFMThresholds, 'tenantId' | 'updatedAt' | 'updatedBy'> = {
  recency: {
    score5: 30,
    score4: 60,
    score3: 90,
    score2: 180,
  },
  frequency: {
    score5: 12,
    score4: 8,
    score3: 4,
    score2: 2,
  },
  monetary: {
    score5: 100000,
    score4: 50000,
    score3: 20000,
    score2: 10000,
  },
};
```

#### 3.5.4 RFMスコア計算の実装

RFMは **日次バッチ** で `customers` の集計値を更新し、
閾値は `settings.attributes`（JSONB）で管理する。

- `customers.total_visits` / `total_spend` / `last_visit_at` を元に算出
- スコアは `customers.rfm_*` に保存
- セグメントは `customers.rfm_segment` に保存

#### 3.5.5 RFM設定変更API

`GET /admin/settings/rfm-thresholds`
- `settings.attributes->rfmThresholds` を返却

`PUT /admin/settings/rfm-thresholds`
- バリデーション後に `settings.attributes` を更新
- 更新後に **RFM再計算ジョブ** をキック

### 3.6 店舗設定画面

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  店舗設定                                                                    │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  [基本情報] │ [営業時間] │ [メニュー] │ [施術者] │ [LINE連携] │ [通知]│   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  店舗名                                                              │   │
│  │  ┌────────────────────────────────────────────────────────┐         │   │
│  │  │ 美容室サロンA 渋谷店                                    │         │   │
│  │  └────────────────────────────────────────────────────────┘         │   │
│  │                                                                      │   │
│  │  住所                                                                │   │
│  │  ┌────────────────────────────────────────────────────────┐         │   │
│  │  │ 東京都渋谷区〇〇 1-2-3                                  │         │   │
│  │  └────────────────────────────────────────────────────────┘         │   │
│  │                                                                      │   │
│  │  電話番号                                                            │   │
│  │  ┌────────────────────────────────────────────────────────┐         │   │
│  │  │ 03-xxxx-xxxx                                           │         │   │
│  │  └────────────────────────────────────────────────────────┘         │   │
│  │                                                                      │   │
│  │  ロゴ画像                                                            │   │
│  │  ┌──────┐                                                           │   │
│  │  │ LOGO │  [画像を変更]                                             │   │
│  │  └──────┘                                                           │   │
│  │                                                                      │   │
│  │  テーマカラー                                                        │   │
│  │  [🔴] #FF6B6B                                                       │   │
│  │                                                                      │   │
│  │                                              [キャンセル] [保存]     │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. コンポーネント設計

### 4.1 共通コンポーネント

```typescript
// 共通コンポーネント一覧
components/
├── layout/
│   ├── Sidebar.tsx           // サイドバーナビゲーション
│   ├── Header.tsx            // ヘッダー（モバイル用）
│   ├── MainLayout.tsx        // メインレイアウト
│   └── MobileNav.tsx         // モバイルナビゲーション
├── dashboard/
│   ├── KPICard.tsx           // KPIカード
│   ├── TodayReservations.tsx // 本日の予約リスト
│   ├── StaffCapacity.tsx     // スタッフ稼働状況
│   └── QuickActions.tsx      // クイックアクション
├── calendar/
│   ├── WeekView.tsx          // 週間カレンダー
│   ├── DayView.tsx           // 日別カレンダー
│   ├── ReservationBlock.tsx  // 予約ブロック
│   └── TimeSlot.tsx          // 時間スロット
├── reservations/
│   ├── ReservationList.tsx   // 予約一覧
│   ├── ReservationCard.tsx   // 予約カード
│   ├── ReservationForm.tsx   // 予約フォーム
│   └── StatusBadge.tsx       // ステータスバッジ
├── customers/
│   ├── CustomerList.tsx      // 顧客一覧
│   ├── CustomerCard.tsx      // 顧客カード
│   ├── CustomerDetail.tsx    // 顧客詳細
│   └── TagBadge.tsx          // タグバッジ
├── kartes/
│   ├── KarteList.tsx         // カルテ一覧
│   ├── KarteCard.tsx         // カルテカード
│   ├── KarteForm.tsx         // カルテ作成フォーム
│   └── PhotoUploader.tsx     // 写真アップロード
├── reports/
│   ├── SalesChart.tsx        // 売上グラフ
│   ├── MenuBreakdown.tsx     // メニュー別内訳
│   ├── StaffPerformance.tsx  // スタッフ別実績
│   └── DateRangePicker.tsx   // 期間選択
└── ui/                        // shadcn/ui ベース
    ├── Button.tsx
    ├── Card.tsx
    ├── Table.tsx
    ├── Dialog.tsx
    ├── Select.tsx
    └── ...
```

### 4.2 ページ構成

```typescript
// Next.js App Router ページ構成
app/
├── layout.tsx                 // ルートレイアウト
├── page.tsx                   // ホーム（ダッシュボード）
├── pos/
│   └── page.tsx               // レジ
├── calendar/
│   ├── page.tsx               // カレンダー
│   └── [date]/
│       └── page.tsx           // 特定日のカレンダー
├── reservations/
│   ├── page.tsx               // 予約一覧
│   ├── new/
│   │   └── page.tsx           // 新規予約
│   └── [id]/
│       └── page.tsx           // 予約詳細
├── kartes/
│   ├── page.tsx               // カルテ一覧
│   ├── new/
│   │   └── page.tsx           // 新規カルテ
│   └── [id]/
│       └── page.tsx           // カルテ詳細
├── customers/
│   ├── page.tsx               // 顧客一覧
│   └── [id]/
│       └── page.tsx           // 顧客詳細
├── reports/
│   └── page.tsx               // レポート
├── inventory/
│   └── page.tsx               // 在庫管理
├── staff/
│   ├── page.tsx               // スタッフ一覧
│   └── [id]/
│       └── page.tsx           // スタッフ詳細
├── settings/
│   ├── page.tsx               // 設定トップ
│   ├── store/
│   │   └── page.tsx           // 店舗設定
│   ├── menus/
│   │   └── page.tsx           // メニュー設定
│   ├── hours/
│   │   └── page.tsx           // 営業時間設定
│   └── line/
│       └── page.tsx           // LINE連携設定
└── api/
    └── ...                    // API Routes
```

---

## 5. デザインシステム

### 5.1 カラーパレット

```css
:root {
  /* Primary - サロンのテーマカラー（動的に設定）*/
  --primary: 220 90% 56%;          /* デフォルト: ブルー */
  --primary-foreground: 210 40% 98%;
  
  /* ニュートラル */
  --background: 0 0% 100%;
  --foreground: 222 47% 11%;
  
  --muted: 210 40% 96%;
  --muted-foreground: 215 16% 47%;
  
  --card: 0 0% 100%;
  --card-foreground: 222 47% 11%;
  
  --border: 214 32% 91%;
  --input: 214 32% 91%;
  
  /* ステータスカラー */
  --success: 142 76% 36%;          /* 完了 */
  --warning: 38 92% 50%;           /* 予約済み */
  --info: 199 89% 48%;             /* 来店中 */
  --danger: 0 84% 60%;             /* キャンセル */
  
  /* サイドバー */
  --sidebar-background: 240 5% 96%;
  --sidebar-foreground: 222 47% 11%;
  --sidebar-accent: var(--primary);
}

/* ダークモード */
.dark {
  --background: 222 47% 11%;
  --foreground: 210 40% 98%;
  
  --muted: 217 33% 17%;
  --muted-foreground: 215 20% 65%;
  
  --card: 222 47% 11%;
  --card-foreground: 210 40% 98%;
  
  --border: 217 33% 17%;
  
  --sidebar-background: 222 47% 11%;
  --sidebar-foreground: 210 40% 98%;
}
```

### 5.2 タイポグラフィ

```css
/* フォント設定 */
:root {
  --font-sans: 'Inter', 'Noto Sans JP', sans-serif;
  --font-mono: 'Fira Code', monospace;
}

/* サイズスケール */
.text-xs    { font-size: 0.75rem; }   /* 12px */
.text-sm    { font-size: 0.875rem; }  /* 14px */
.text-base  { font-size: 1rem; }      /* 16px */
.text-lg    { font-size: 1.125rem; }  /* 18px */
.text-xl    { font-size: 1.25rem; }   /* 20px */
.text-2xl   { font-size: 1.5rem; }    /* 24px */
.text-3xl   { font-size: 1.875rem; }  /* 30px */
.text-4xl   { font-size: 2.25rem; }   /* 36px */
```

### 5.3 スペーシング

```css
/* Tailwind デフォルトスケール */
/* 4px単位のスケール */
.p-1 { padding: 0.25rem; }   /* 4px */
.p-2 { padding: 0.5rem; }    /* 8px */
.p-3 { padding: 0.75rem; }   /* 12px */
.p-4 { padding: 1rem; }      /* 16px */
.p-5 { padding: 1.25rem; }   /* 20px */
.p-6 { padding: 1.5rem; }    /* 24px */
.p-8 { padding: 2rem; }      /* 32px */
```

---

## 6. レスポンシブ対応

### 6.1 ブレークポイント

| サイズ | 幅 | 対象デバイス |
|--------|-----|-------------|
| `sm` | 640px | タブレット（縦） |
| `md` | 768px | タブレット（横） |
| `lg` | 1024px | ラップトップ |
| `xl` | 1280px | デスクトップ |
| `2xl` | 1536px | 大画面 |

### 6.2 レイアウト変更

```tsx
// サイドバーのレスポンシブ対応
export function Sidebar() {
  return (
    <>
      {/* デスクトップ: 常に表示 */}
      <aside className="hidden lg:flex lg:w-64 lg:flex-col lg:fixed lg:inset-y-0">
        <SidebarContent />
      </aside>
      
      {/* モバイル/タブレット: Sheet（ドロワー） */}
      <Sheet>
        <SheetTrigger asChild className="lg:hidden">
          <Button variant="ghost" size="icon">
            <MenuIcon />
          </Button>
        </SheetTrigger>
        <SheetContent side="left" className="w-64 p-0">
          <SidebarContent />
        </SheetContent>
      </Sheet>
    </>
  );
}
```

---

## 7. 状態管理

### 7.1 React Query によるサーバー状態管理

```typescript
// hooks/useReservations.ts
export function useReservations(date: string) {
  return useQuery({
    queryKey: ['reservations', date],
    queryFn: () => fetchReservations(date),
    staleTime: 1000 * 60 * 5, // 5分間キャッシュ
  });
}

// hooks/useDashboardStats.ts
export function useDashboardStats() {
  return useQuery({
    queryKey: ['dashboard', 'stats'],
    queryFn: fetchDashboardStats,
    refetchInterval: 1000 * 60, // 1分ごとに更新
  });
}
```

### 7.2 Zustand によるクライアント状態管理

```typescript
// stores/uiStore.ts
interface UIState {
  sidebarOpen: boolean;
  toggleSidebar: () => void;
  
  selectedStaff: string | null;
  setSelectedStaff: (staffId: string | null) => void;
}

export const useUIStore = create<UIState>((set) => ({
  sidebarOpen: true,
  toggleSidebar: () => set((state) => ({ sidebarOpen: !state.sidebarOpen })),
  
  selectedStaff: null,
  setSelectedStaff: (staffId) => set({ selectedStaff: staffId }),
}));
```

---

## 8. アクセシビリティ

### 8.1 キーボードナビゲーション

- `Tab`: フォーカス移動
- `Enter` / `Space`: ボタン・リンクの実行
- `Escape`: モーダル・ドロワーを閉じる
- `Arrow Keys`: メニュー・カレンダーの移動

### 8.2 スクリーンリーダー対応

```tsx
// 適切なARIAラベルを付与
<Button aria-label="新規予約を作成">
  <PlusIcon />
  <span className="sr-only">新規予約を作成</span>
</Button>

// ライブリージョン（動的更新の通知）
<div role="status" aria-live="polite">
  {successMessage}
</div>
```

---

## 更新履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|----------|
| 2.1.0 | 2026-01-31 | RFM実装/設定APIの記述をPostgreSQL前提へ更新 |
| 2.0.0 | 2026-01-30 | RFM分析のカスタマイズ機能追加（テナントごとの閾値設定）、顧客セグメント一覧画面、関連ドキュメントリンク追加 |
| 1.0.0 | 2025-01-30 | 初版作成 |
