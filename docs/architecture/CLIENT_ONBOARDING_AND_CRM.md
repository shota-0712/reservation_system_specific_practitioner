# テナントオンボーディング & CRM 設計書

**バージョン**: 2.1.0
**最終更新日**: 2026-01-31
**ステータス**: Active

---

## 1. 目的

- 新規テナントの導入を標準化
- 管理者/店舗/顧客の初期設定を自動化
- CRMデータを一貫した設計で管理

---

## 2. オンボーディングフロー

1. テナント作成（`tenants`）
2. 管理者アカウント作成（Firebase Auth + `admins`）
3. 店舗作成（`stores`）
4. 店舗コード発行（`stores.store_code`）
5. LINEミニアプリ設定（`tenants.line_*`）
6. 初期メニュー/スタッフ登録

---

## 3. データモデル（CRM）

### 3.1 顧客
- `customers` テーブルに格納
- LINEユーザーIDで一意に管理
- 集計値（来店回数/売上）は非正規化

### 3.2 RFM分析
- `customers` に `rfm_*` を持たせる
- バッチで更新（週1回）

---

## 4. 顧客マイページ機能

- LINEミニアプリで **過去予約/次回予約** を表示
- APIは `GET /reservations/my`
- 顧客単位で **予約履歴 + カルテ** を参照可能

---

## 5. 拡張（エンタープライズ）

- 複数店舗の顧客統合
- VIP判定や自動キャンペーン連携
- BigQueryで分析

